!function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const s={channels__button:document.querySelector(".channels"),people__button:document.querySelector(".people-online"),channels__people:document.querySelector(".results"),create__channel:document.querySelector(".create-room"),create__channelInput:document.querySelector(".new__room__field"),newchannelError_text:document.querySelector(".newchannelError_text"),sendMessage_button:document.querySelector(".send-message"),sendMessage_text:document.querySelector(".message-text"),messages__container:document.querySelector(".messages"),newroom__input:document.querySelector(".new__room__field"),direct_message:document.querySelector(".private_message"),direct_messageSender:document.querySelector(".private_message_header"),direct_messageText:document.querySelector(".private_message_text"),private_message_value:document.querySelector(".reply_private_message"),direct_message_replyButton:document.querySelector(".private_message_reply"),direct_message_ignoreButton:document.querySelector(".private_message_ignore")};class a{constructor(e){this.query=e}async getResult(){let e=new FormData;e.append("list",this.query),await fetch(`${location.protocol}//${location.hostname}:${location.port}/chat`,{method:"POST",body:e}).then(e=>e.json()).then(e=>{this.results=e})}}const r=(e,t)=>{let n=!1;if(document.querySelectorAll(".list_style").forEach(e=>{e.innerHTML===t.newuser&&(e.setAttribute("id",t.sid),n=!0)}),1==n)n=!1;else{const n=document.createElement("li");n.setAttribute("value",e);var a=t;n.classList.add("list_style"),"people"==e?(n.setAttribute("id",a.id),n.innerHTML=a.newuser):n.innerHTML=a,s.channels__people.append(n)}};var o="",c={current_chatting:{}};const l=io.connect(`${location.protocol}//${location.hostname}:${location.port}`);l.on("connect",e=>{console.log("SocketIO connection Established"),e&&(document.querySelector(".login_user").innerHTML=`<p>Welcome ${e.username}, Enjoy Chatting with our Flack Chat App</p><p>You can create new channel, chat inside any channel you select and send private message to any online user</p>`,o=e.username,c.current_chatting.connector=e.room)}),l.on("message",e=>{((e,t)=>{if(e.join||e.leave){const t=e.join||e.leave,n=document.createElement("p");n.classList.add("join_room_person"),n.innerHTML=t,s.messages__container.append(n)}else{const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("p"),o=document.createElement("p"),c=document.createElement("span");a.append(r),n.append(o),n.append(a),n.append(c),s.messages__container.append(n),o.innerHTML=e.username+":",r.innerHTML=e.message,c.innerHTML=e.time,o.classList.add("message-username"),a.classList.add("message-container"),c.classList.add("time-style"),t==e.username?(a.classList.add("message-container-userColor"),n.classList.add("whole-message-box-owner")):(a.classList.add("message-container-strangeColor"),n.classList.add("whole-message-box-strange"))}s.messages__container.scrollTop=s.messages__container.scrollHeight-s.messages__container.clientHeight})(e,o)}),l.on("updateList",e=>{e.newuser&&"people"==s.channels__people.getAttribute("data-type")?r("people",e):e.newroom&&"channels"==s.channels__people.getAttribute("data-type")&&r("channels",e.newroom)}),l.on("update_room",e=>{(e=>{let t=e.room,n=new FormData;n.append("room",t),fetch(`${location.protocol}//${location.hostname}:${location.port}/update/room`,{method:"POST",body:n}).then(e=>e.json()).then(e=>{console.log("Room sent successfully")})})(e)}),l.on("remember_channel",async e=>{if(e.room){s.channels__button.click(),((e,t)=>{let n=e;for(let e of n){const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("p"),o=document.createElement("p"),c=document.createElement("span");a.append(r),n.append(o),n.append(a),n.append(c),s.messages__container.append(n),o.innerHTML=e[0]+":",r.innerHTML=e[1],c.innerHTML=e[2],o.classList.add("message-username"),a.classList.add("message-container"),c.classList.add("time-style"),t==e[0]?(a.classList.add("message-container-userColor"),n.classList.add("whole-message-box-owner")):(a.classList.add("message-container-strangeColor"),n.classList.add("whole-message-box-strange"))}})(await(async e=>{let t;return await fetch(`${location.protocol}//${location.hostname}:${location.port}/messages/${e.room}`).then(e=>e.json()).then(e=>{t=e.messages}),t})(e),o),l.emit("join",{room:e.room}),s.sendMessage_button.classList.add("sendButton__text_hide"),s.sendMessage_text.classList.add("sendButton__text_hide"),t=e.room,s.channels__people.childNodes.forEach(e=>{e.innerHTML==t&&e.classList.add("style-selected-room")})}var t});const i=io("/private");i.on("private",e=>{document.querySelector(".receive-message-alert").classList.add("display_private_message"),c.current_chatting.data=e}),s.channels__button.addEventListener("click",e=>{e.preventDefault(),d("channels")}),s.people__button.addEventListener("click",e=>{e.preventDefault(),d("people")});const d=async e=>{"channels"==e?(s.channels__people.setAttribute("data-type","channels"),s.channels__button.classList.add("button-color"),s.people__button.classList.remove("button-color"),s.create__channel.classList.remove("disable__roomButton"),s.create__channelInput.classList.remove("disable__roomButton")):"people"==e&&(s.channels__people.setAttribute("data-type","people"),s.channels__button.classList.remove("button-color"),s.people__button.classList.add("button-color"),s.create__channel.classList.add("disable__roomButton"),s.create__channelInput.classList.add("disable__roomButton")),c.listRequestResult=new a(e),await c.listRequestResult.getResult(),((e,t)=>{let n=e.data,a=e.list_type;s.channels__people.innerHTML="";let r=Object.keys(n);for(let e of r)if(n[e].name!==t||"channels"==a){const t=document.createElement("li");t.classList.add("list_style"),t.setAttribute("value",a),"people"==a?(t.setAttribute("id",n[e].id),t.innerHTML=n[e].name):t.innerHTML=e,s.channels__people.append(t)}})(c.listRequestResult.results,o)};s.create__channel.addEventListener("click",e=>{e.preventDefault(),u()});const u=async()=>{if((()=>{if(s.create__channelInput.value.length>0)return!0;s.newchannelError_text.innerHTML="Please enter unique channel name",s.newchannelError_text.classList.add("display_createChannelButton_Error")})()){(e=>{let t=e.data;e.list_type;"used"==t?(s.newchannelError_text.innerHTML="Please enter unique channel name",s.newchannelError_text.classList.add("display_createChannelButton_Error"),s.create__channelInput.value=""):(s.newchannelError_text.classList.remove("display_createChannelButton_Error"),s.create__channelInput.value="")})(await(async()=>{let e,t=new FormData;return t.append("channel",s.create__channelInput.value),await fetch(`${location.protocol}//${location.hostname}:${location.port}/chat/newChannel`,{method:"POST",body:t}).then(e=>e.json()).then(t=>{e=t}),e})())}};s.channels__people.addEventListener("click",e=>{"channels"==e.target.getAttribute("value")?m(e):_(e)});const m=async e=>{if(c.current_chatting.connector==e.target.textContent)return!1;c.current_chatting.connector&&l.emit("leave",{room:c.current_chatting.connector}),c.current_chatting.connector=e.target.textContent,c.current_chatting.type=e.target.getAttribute("value"),s.messages__container.innerHTML="",((e,t)=>{for(let n of e){const e=document.createElement("div"),a=document.createElement("div"),r=document.createElement("p"),o=document.createElement("p"),c=document.createElement("span");a.append(r),e.append(o),e.append(a),e.append(c),s.messages__container.append(e),o.innerHTML=n[0]+":",r.innerHTML=n[1],c.innerHTML=n[2],o.classList.add("message-username"),a.classList.add("message-container"),c.classList.add("time-style"),t==n[0]?(a.classList.add("message-container-userColor"),e.classList.add("whole-message-box-owner")):(a.classList.add("message-container-strangeColor"),e.classList.add("whole-message-box-strange"))}})(await(async e=>{let t;return await fetch(`${location.protocol}//${location.hostname}:${location.port}/messages/${e}`).then(e=>e.json()).then(e=>{t=e.messages}),t})(c.current_chatting.connector),o),l.emit("join",{room:c.current_chatting.connector}),s.sendMessage_button.classList.add("sendButton__text_hide"),s.sendMessage_text.classList.add("sendButton__text_hide"),(e=>{s.channels__people.childNodes.forEach(e=>{e.classList.remove("style-selected-room")}),e.target.classList.add("style-selected-room")})(e)},_=e=>{c.current_chatting.connector=e.target.getAttribute("id"),c.current_chatting.type=e.target.getAttribute("value"),(e=>{document.querySelector(".black-background").classList.add("display_private_message"),s.direct_message.classList.add("display_private_message"),s.direct_message.setAttribute("id",e.target.getAttribute("id")),s.direct_message_replyButton.textContent="Send",s.direct_message_ignoreButton.textContent="cancel",s.direct_messageSender.textContent=`send a message to ${e.target.textContent}:`})(e)};document.querySelector(".alert-open").addEventListener("click",e=>{var t;t=c.current_chatting.data,document.querySelector(".black-background").classList.add("display_private_message"),s.direct_message.setAttribute("id",t.sender_id),s.direct_messageSender.textContent="A message from: "+t.sender,s.direct_messageText.textContent=t.message,s.direct_message_replyButton.textContent="reply",s.direct_message_ignoreButton.textContent="ignore",s.direct_message.classList.add("display_private_message"),document.querySelector(".receive-message-alert").classList.remove("display_private_message")}),document.querySelector(".alert-ignore").addEventListener("click",e=>{document.querySelector(".receive-message-alert").classList.remove("display_private_message")}),s.sendMessage_button.addEventListener("click",e=>{e.preventDefault(),"people"==c.current_chatting.type?i.emit("private",{message:s.sendMessage_text.value,id:c.current_chatting.connector}):l.emit("message",{message:s.sendMessage_text.value,room:c.current_chatting.connector}),s.sendMessage_text.value=""}),s.direct_message_replyButton.addEventListener("click",e=>{i.emit("private",{id:s.direct_message.getAttribute("id"),message:s.private_message_value.value}),s.direct_message.classList.remove("display_private_message"),s.private_message_value.value="",document.querySelector(".black-background").classList.remove("display_private_message")}),s.direct_message_ignoreButton.addEventListener("click",()=>{s.direct_message.classList.remove("display_private_message"),document.querySelector(".black-background").classList.remove("display_private_message")})}]);